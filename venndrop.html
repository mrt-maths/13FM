<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Venn Diagram Probability Drag & Drop</title>
  <style>
    :root{
      --bg:#0b1020;
      --ink:#e8ecff;
      --muted:#b7c0ff;
      --line:rgba(255,255,255,.15);
      --good:#2be39b;
      --bad:#ff5577;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 700px at 15% 5%, rgba(122,162,255,.20), transparent 55%),
                  radial-gradient(900px 650px at 85% 25%, rgba(43,227,155,.14), transparent 60%),
                  var(--bg);
      color:var(--ink);
    }
    header{
      padding:18px 18px 10px;
      display:flex;
      align-items:flex-end;
      gap:12px;
      flex-wrap:wrap;
    }
    header h1{
      margin:0;
      font-size:18px;
      letter-spacing:.2px;
      font-weight:700;
    }
    header .sub{
      color:var(--muted);
      font-size:13px;
      margin-bottom:1px;
      line-height:1.25rem;
    }

    .wrap{
      display:grid;
      grid-template-columns: 420px 1fr;
      gap:14px;
      padding: 10px 14px 220px;
      align-items:start;
    }
    @media (max-width: 980px){
      .wrap{ grid-template-columns: 1fr; padding-bottom:260px; }
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border: 1px solid var(--line);
      border-radius: 14px;
      box-shadow: 0 16px 40px rgba(0,0,0,.25);
      overflow:hidden;
    }
    .card .hd{
      padding:12px 12px 10px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
    .card .hd .title{
      font-weight:700;
      font-size:14px;
      letter-spacing:.2px;
    }
    .controls{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
    }
    button{
      background: rgba(122,162,255,.18);
      color:var(--ink);
      border:1px solid rgba(122,162,255,.35);
      padding:8px 10px;
      border-radius:10px;
      cursor:pointer;
      font-weight:650;
      font-size:13px;
    }
    button:hover{ filter:brightness(1.08); }
    button.secondary{
      background: rgba(255,255,255,.06);
      border-color: rgba(255,255,255,.16);
    }
    button.hiddenBtn{ display:none; }
    .pill{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.05);
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
    }
    .body{ padding:12px; }

    .stickyLeft{
      position: sticky;
      top: 10px;
      align-self:start;
    }
    @media (max-width: 980px){
      .stickyLeft{ position: static; }
    }

    .note{
      font-size:13px;
      color:var(--muted);
      line-height:1.25rem;
    }
    .svgWrap{
      background: rgba(0,0,0,.15);
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px;
      margin-top:10px;
    }

    .drop{
      width:56px;
      height:34px;
      border-radius:10px;
      border:1px dashed rgba(255,255,255,.28);
      background: rgba(255,255,255,.04);
      display:flex;
      align-items:center;
      justify-content:center;
      color:rgba(255,255,255,.65);
      font-weight:800;
      user-select:none;
      position:relative;
      z-index:1;
    }
    .drop.small{ width:50px; height:32px; border-radius:9px; }
    .drop.filled{
      border-style:solid;
      border-color: rgba(255,255,255,.20);
      background: rgba(255,255,255,.07);
      color: var(--ink);
    }
    .drop.good{ outline:2px solid rgba(43,227,155,.65); }
    .drop.bad{ outline:2px solid rgba(255,85,119,.65); }

    .tile{
      width:56px;
      height:34px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.22);
      background: linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.06));
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:900;
      letter-spacing:.3px;
      cursor:grab;
      user-select:none;
      box-shadow: 0 8px 18px rgba(0,0,0,.25);
    }
    .tile:active{ cursor:grabbing; transform: translateY(1px); }
    .tile.locked{
      cursor: default;
      box-shadow:none;
      border-color: rgba(255,255,255,.16);
      background: rgba(255,255,255,.10);
    }

    .qGrid{ display:grid; grid-template-columns: 1fr; gap:10px; }
    .q{
      background: rgba(0,0,0,.14);
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .q .label{ font-size:14px; font-weight:700; }
    .frac{ display:flex; align-items:center; gap:10px; }
    .fracBox{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:6px;
      min-width:72px;
    }
    .bar{
      height:2px;
      width:72px;
      background: rgba(255,255,255,.22);
      border-radius: 999px;
    }
    .math{ font-variant-numeric: tabular-nums; }

    .pileDock{
      position:fixed;
      left:0; right:0; bottom:0;
      padding:10px 12px;
      background: linear-gradient(180deg, rgba(11,16,32,0), rgba(11,16,32,.78) 20%, rgba(11,16,32,.92));
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(255,255,255,.12);
      z-index: 50;
    }
    .pileCard{
      max-width: 1100px;
      margin:0 auto;
      background: rgba(18,26,51,.72);
      border:1px solid rgba(255,255,255,.12);
      border-radius: 16px;
      padding:10px;
      box-shadow: 0 20px 50px rgba(0,0,0,.35);
    }
    .pileTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:8px;
    }
    .pileTop .hint{ color:var(--muted); font-size:13px; }
    .pile{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      min-height:52px;
      padding:8px;
      border-radius:12px;
      background: rgba(0,0,0,.18);
      border:1px dashed rgba(255,255,255,.16);
    }

    .okMsg{ color: var(--good); font-weight:800; }
    .badMsg{ color: var(--bad); font-weight:800; }

    .svgSmall{
      font-size: 12px;
      font-weight: 750;
      fill: rgba(255,255,255,.88);
    }
  </style>
</head>
<body>
  <header>
    <div>
      <h1>2-Circle Venn Diagram: Probability Drag & Drop</h1>
      <div class="sub">
        Drag the number tiles into place (4 in the Venn + 20 in the 10 fractions).<br/>
        <b>Fractions are left unsimplified.</b> No conditional probability.
      </div>
    </div>
  </header>

  <main class="wrap">
    <!-- Left: Venn (sticky) -->
    <section class="card stickyLeft">
      <div class="hd">
        <div class="title">Venn diagram (sample space Ω)</div>
        <div class="pill" id="progressPill">Placed: 0 / 24</div>
      </div>

      <div class="body">
        <div class="note">
          Regions correspond to: <span class="math">A ∩ B'</span>, <span class="math">A ∩ B</span>, <span class="math">A' ∩ B</span>, and <span class="math">A' ∩ B'</span>.
        </div>

        <div class="svgWrap">
          <svg viewBox="0 0 380 260" width="100%" height="auto" aria-label="Venn diagram">
            <rect x="10" y="10" width="360" height="240" rx="14"
                  fill="rgba(255,255,255,0.03)" stroke="rgba(255,255,255,0.18)" stroke-width="2"/>
            <text x="20" y="30" class="svgSmall">Ω</text>

            <circle cx="160" cy="135" r="85" fill="rgba(122,162,255,0.16)" stroke="rgba(122,162,255,0.55)" stroke-width="2"/>
            <circle cx="230" cy="135" r="85" fill="rgba(43,227,155,0.12)" stroke="rgba(43,227,155,0.55)" stroke-width="2"/>

            <text x="120" y="65" class="svgSmall">A</text>
            <text x="255" y="65" class="svgSmall">B</text>

            <foreignObject x="105" y="125" width="70" height="40">
              <div xmlns="http://www.w3.org/1999/xhtml" class="drop" data-zone="venn_AcapBprime"></div>
            </foreignObject>
            <foreignObject x="175" y="125" width="70" height="40">
              <div xmlns="http://www.w3.org/1999/xhtml" class="drop" data-zone="venn_AcapB"></div>
            </foreignObject>
            <foreignObject x="245" y="125" width="70" height="40">
              <div xmlns="http://www.w3.org/1999/xhtml" class="drop" data-zone="venn_AprimeCapB"></div>
            </foreignObject>
            <foreignObject x="285" y="200" width="70" height="40">
              <div xmlns="http://www.w3.org/1999/xhtml" class="drop" data-zone="venn_AprimeCapBprime"></div>
            </foreignObject>
          </svg>
        </div>

        <div class="note" id="statusLine" style="margin-top:10px;">
          One number is already placed for you. (The “Check” button appears after 3 minutes.)
        </div>
      </div>
    </section>

    <!-- Right: Questions -->
    <section class="card">
      <div class="hd">
        <div class="title">Probability questions (fractions unsimplified)</div>
        <div class="controls">
          <button class="secondary hiddenBtn" id="checkBtn">Check</button>
          <button class="secondary" id="clearBtn">Clear all</button>
          <button class="secondary" id="fullscreenBtn">Fullscreen</button>
          <button id="newBtn">New numbers</button>
        </div>
      </div>
      <div class="body">
        <div class="qGrid" id="qGrid"></div>
      </div>
    </section>
  </main>

  <!-- Pile -->
  <div class="pileDock">
    <div class="pileCard">
      <div class="pileTop">
        <div class="hint">Number pile (drag from here). Drag a tile back into the pile to undo.</div>
        <div class="pill" id="resultPill">Not checked yet</div>
      </div>
      <div class="pile" id="pile" aria-label="number pile"></div>
    </div>
  </div>

<script>
(() => {
  const $ = (sel, root=document) => root.querySelector(sel);
  const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
  const randInt = (a,b) => Math.floor(Math.random()*(b-a+1))+a;

  let solution = null;
  let placedCount = 0;
  let prefilledZone = null;

  const CHECK_DELAY_MS = 3 * 60 * 1000;
  let checkTimer = null;

  // ✅ Q8 changed to P(A' ∪ B)
  const QUESTIONS = [
    { set: "P(A)",          numZone: "q1_num",  denZone: "q1_den"  },
    { set: "P(B)",          numZone: "q2_num",  denZone: "q2_den"  },
    { set: "P(A ∩ B)",      numZone: "q3_num",  denZone: "q3_den"  },
    { set: "P(A ∪ B)",      numZone: "q4_num",  denZone: "q4_den"  },
    { set: "P(A')",         numZone: "q5_num",  denZone: "q5_den"  },
    { set: "P(B')",         numZone: "q6_num",  denZone: "q6_den"  },
    { set: "P(A ∩ B')",     numZone: "q7_num",  denZone: "q7_den"  },
    { set: "P(A' ∪ B)",     numZone: "q8_num",  denZone: "q8_den"  },
    { set: "P(A' ∩ B')",    numZone: "q9_num",  denZone: "q9_den"  },
    { set: "P(A △ B)",      numZone: "q10_num", denZone: "q10_den" }
  ];

  function buildQuestions() {
    const grid = $("#qGrid");
    grid.innerHTML = "";
    for (const q of QUESTIONS){
      const row = document.createElement("div");
      row.className = "q";
      row.innerHTML = `
        <div class="label math">${q.set}</div>
        <div class="frac">
          <div class="fracBox">
            <div class="drop small" data-zone="${q.numZone}" aria-label="${q.set} numerator"></div>
            <div class="bar"></div>
            <div class="drop small" data-zone="${q.denZone}" aria-label="${q.set} denominator"></div>
          </div>
        </div>
      `;
      grid.appendChild(row);
    }
  }

  function makeTile(tileData){
    const div = document.createElement("div");
    div.className = "tile";
    div.textContent = tileData.value;
    div.draggable = true;
    div.dataset.tileId = tileData.id;
    div.dataset.value = String(tileData.value);

    div.addEventListener("dragstart", (e) => {
      e.dataTransfer.setData("text/tileId", tileData.id);
      const fromZone = div.closest(".drop")?.dataset.zone || "";
      e.dataTransfer.setData("text/fromZone", fromZone);
      e.dataTransfer.effectAllowed = "move";
      requestAnimationFrame(()=> div.style.opacity="0.55");
    });
    div.addEventListener("dragend", () => div.style.opacity="1");
    return div;
  }

  function makeLockedTile(value){
    const div = document.createElement("div");
    div.className = "tile locked";
    div.textContent = value;
    div.draggable = false;
    div.dataset.value = String(value);
    return div;
  }

  function countPlacedTiles(){ return $$(".drop .tile").length; }
  function updateProgress(){ $("#progressPill").textContent = `Placed: ${placedCount} / 24`; }

  function setResult(text, kind){
    const pill = $("#resultPill");
    pill.textContent = text;
    pill.classList.remove("okMsg","badMsg");
    if (kind === "good") pill.classList.add("okMsg");
    if (kind === "bad") pill.classList.add("badMsg");
  }

  function clearZone(zoneEl, {silent=false} = {}){
    if (prefilledZone && zoneEl.dataset.zone === prefilledZone) return;
    const tile = zoneEl.querySelector(".tile");
    if (tile) $("#pile").appendChild(tile);
    zoneEl.classList.remove("filled","good","bad");
    if (!silent){
      placedCount = countPlacedTiles();
      updateProgress();
      setResult("Not checked yet", null);
    }
  }

  function clearAll(){
    $$(".drop").forEach(z => clearZone(z, {silent:true}));
    placedCount = countPlacedTiles();
    updateProgress();
    setResult("Not checked yet", null);
    $("#statusLine").textContent = "Cleared (starter tile kept). Drag the tiles again.";
  }

  function wireDnD(){
    $$(".drop").forEach(zone => {
      zone.addEventListener("dragover", (e) => { e.preventDefault(); e.dataTransfer.dropEffect = "move"; });
      zone.addEventListener("drop", (e) => {
        e.preventDefault();
        const tileId = e.dataTransfer.getData("text/tileId");
        if (!tileId) return;

        if (prefilledZone && zone.dataset.zone === prefilledZone) return;
        if (zone.querySelector(".tile")) return;

        const tileEl = document.querySelector(`.tile[data-tile-id="${CSS.escape(tileId)}"]`);
        if (!tileEl) return;

        zone.appendChild(tileEl);
        zone.classList.add("filled");
        zone.classList.remove("good","bad");
        placedCount = countPlacedTiles();
        updateProgress();
        setResult("Not checked yet", null);
      });
    });

    const pile = $("#pile");
    pile.addEventListener("dragover", (e) => { e.preventDefault(); e.dataTransfer.dropEffect="move"; });
    pile.addEventListener("drop", (e) => {
      e.preventDefault();
      const tileId = e.dataTransfer.getData("text/tileId");
      if (!tileId) return;

      const tileEl = document.querySelector(`.tile[data-tile-id="${CSS.escape(tileId)}"]`);
      if (!tileEl) return;

      pile.appendChild(tileEl);

      const fromZone = e.dataTransfer.getData("text/fromZone");
      if (fromZone){
        const z = document.querySelector(`.drop[data-zone="${CSS.escape(fromZone)}"]`);
        if (z && (!prefilledZone || z.dataset.zone !== prefilledZone) && !z.querySelector(".tile")){
          z.classList.remove("filled","good","bad");
        }
      }
      placedCount = countPlacedTiles();
      updateProgress();
      setResult("Not checked yet", null);
    });
  }

  function checkAll(){
    let correct = 0;
    let total = 0;

    $$(".drop").forEach(zone => {
      total++;
      const needed = solution.zones[zone.dataset.zone];
      const tile = zone.querySelector(".tile");
      if (!tile){
        zone.classList.remove("good","bad");
        return;
      }
      const v = Number(tile.dataset.value);
      const ok = (v === needed);
      zone.classList.toggle("good", ok);
      zone.classList.toggle("bad", !ok);
      correct += ok ? 1 : 0;
    });

    const allPlaced = (placedCount === 24);
    const allCorrect = (correct === total) && allPlaced;

    if (!allPlaced){
      setResult(`Placed ${placedCount}/24. Checked: ${correct}/${total} correct.`, null);
      $("#statusLine").textContent = "Keep going — you haven't placed all tiles yet.";
    } else if (allCorrect){
      setResult("Perfect! All 24 tiles are correct ✅", "good");
      $("#statusLine").textContent = "Well done — everything matches the Venn diagram and the probabilities.";
    } else {
      setResult(`Checked: ${correct}/${total} correct. Fix the red boxes.`, "bad");
      $("#statusLine").textContent = "Some tiles are incorrect — swap them until all boxes are green.";
    }

    hideCheckAndReschedule();
  }

  function scheduleCheckButton(){
    const btn = $("#checkBtn");
    btn.classList.add("hiddenBtn");
    if (checkTimer) clearTimeout(checkTimer);
    checkTimer = setTimeout(() => {
      btn.classList.remove("hiddenBtn");
      $("#statusLine").textContent = "You can use “Check” now.";
    }, CHECK_DELAY_MS);
  }

  function hideCheckAndReschedule(){
    const btn = $("#checkBtn");
    btn.classList.add("hiddenBtn");
    $("#statusLine").textContent = "Check used. It will reappear in 3 minutes.";
    if (checkTimer) clearTimeout(checkTimer);
    checkTimer = setTimeout(() => {
      btn.classList.remove("hiddenBtn");
      $("#statusLine").textContent = "You can use “Check” now.";
    }, CHECK_DELAY_MS);
  }

  function generatePuzzle(){
    // Regions: A∩B', A∩B, A'∩B, A'∩B'
    const aCapBprime = randInt(1, 9);
    const aCapB      = randInt(1, 9);
    const aPrimeCapB = randInt(1, 9);
    const aPrimeCapBprime = randInt(1, 9);
    const N = aCapBprime + aCapB + aPrimeCapB + aPrimeCapBprime;

    // Values for each drop zone (fractions unsimplified)
    const zones = {
      // Venn (4)
      venn_AcapBprime: aCapBprime,
      venn_AcapB: aCapB,
      venn_AprimeCapB: aPrimeCapB,
      venn_AprimeCapBprime: aPrimeCapBprime,

      // Questions (20)
      q1_num: (aCapBprime + aCapB),                  q1_den: N, // P(A)
      q2_num: (aCapB + aPrimeCapB),                  q2_den: N, // P(B)
      q3_num: aCapB,                                 q3_den: N, // P(A∩B)
      q4_num: (N - aPrimeCapBprime),                 q4_den: N, // P(A∪B)
      q5_num: (aPrimeCapB + aPrimeCapBprime),        q5_den: N, // P(A')
      q6_num: (aCapBprime + aPrimeCapBprime),        q6_den: N, // P(B')
      q7_num: aCapBprime,                            q7_den: N, // P(A∩B')
      // ✅ P(A' ∪ B) = 1 - P(A ∩ B') so numerator = N - (A∩B')
      q8_num: (N - aCapBprime),                      q8_den: N, // P(A' ∪ B)
      q9_num: aPrimeCapBprime,                       q9_den: N, // P(A'∩B')
      q10_num: (aCapBprime + aPrimeCapB),            q10_den: N  // P(A △ B)
    };

    solution = { zones };

    // Reset zones
    $$(".drop").forEach(z => {
      z.classList.remove("filled","good","bad");
      z.innerHTML = "";
    });
    prefilledZone = null;

    // Starter: either in Venn or a numerator (not denominators)
    const starterCandidates = [
      "venn_AcapBprime", "venn_AcapB", "venn_AprimeCapB", "venn_AprimeCapBprime",
      "q1_num","q2_num","q3_num","q4_num","q5_num","q6_num","q7_num","q8_num","q9_num","q10_num"
    ];
    prefilledZone = starterCandidates[Math.floor(Math.random() * starterCandidates.length)];
    const starterZoneEl = document.querySelector(`.drop[data-zone="${prefilledZone}"]`);
    if (starterZoneEl){
      starterZoneEl.appendChild(makeLockedTile(zones[prefilledZone]));
      starterZoneEl.classList.add("filled");
    }

    // Create tiles for remaining zones
    const zoneOrder = Object.keys(zones).filter(z => z !== prefilledZone);
    const tiles = zoneOrder.map((zone, idx) => ({
      id: `t_${Date.now()}_${idx}_${Math.random().toString(16).slice(2)}`,
      value: zones[zone]
    }));

    // Shuffle
    for (let k=tiles.length-1;k>0;k--){
      const r = Math.floor(Math.random()*(k+1));
      [tiles[k], tiles[r]] = [tiles[r], tiles[k]];
    }

    const pile = $("#pile");
    pile.innerHTML = "";
    tiles.forEach(t => pile.appendChild(makeTile(t)));

    placedCount = countPlacedTiles(); // starter = 1
    updateProgress();
    setResult("Not checked yet", null);
    $("#statusLine").textContent = "One number is already placed for you. (The “Check” button appears after 3 minutes.)";

    scheduleCheckButton();
  }

  async function toggleFullscreen(){
    try{
      if (!document.fullscreenElement){
        await document.documentElement.requestFullscreen();
      } else {
        await document.exitFullscreen();
      }
    } catch(e){}
  }

  // Init
  buildQuestions();
  wireDnD();
  generatePuzzle();

  $("#checkBtn").addEventListener("click", checkAll);
  $("#clearBtn").addEventListener("click", clearAll);
  $("#newBtn").addEventListener("click", generatePuzzle);
  $("#fullscreenBtn").addEventListener("click", toggleFullscreen);
})();
</script>
</body>
</html>
